---
layout: post
title: Zabbix - включаем шифрование для Агента (Agent Encryption)
---

Если необходимо шифровать соединение между агентом и сервером нам потребуется включить шифрование. Можно использовать шифрование по сертификату или по PSK (ключу Pre-Shared Key). В этом примере я рассмотрю именно PSK, т.к. это на мой взгляд самый удобный способ шифрования: ключ сгенерировать легко и просто, так же можно использовать несколько ключей.

### Установка Агента

Если у нас Linux или что-то подобное - нам повезло, ставим агента при помощи apt, rpm и прочих удобных штук, агент уже идет со всеми необходимыми библиотеками. Или загружаем агента отсюда: https://www.zabbix.com/download_agents при этом нам нужна версия с поддержкой шифрования (в поле Encryption должно быть написано OpenSSL).

### Создаем ключ PSK

```shell
openssl rand -hex 32
```

Полученный ключ сохраняем в файл zabbix_agentd.psk и копируем его в /etc/zabbix/.

### Настройка агента

Добавляем в файл zabbix_agentd.conf настройки шифрования:

```
TLSConnect=psk
TLSAccept=psk
TLSPSKIdentity=PSK001
TLSPSKFile=/etc/zabbix/zabbix_agentd.psk
```

### Настройка сервера Zabbix

Заходим в настройки хоста (Configuratiob → Hosts → ваш_хост) и открываем закладку Encyption. Заполняем поля:

* Connection to host: PSK (Подключение к хосту от сервера Zabbix) 
* Connection from host: PSK (Подключение от хоста к серверу Zabbix) 
* PSK identity: PSK001 (Номер ключа в файле)
* PSK: ваш_PSK_ключ (Сам ключ)

Применяем настройки, запускаем агент и смотрим логи - все должно заработать.