I"D<p>В этом примере 195.16.153.30 - внешний, полученый через ВПН адрес (ppp0)</p>

<p>Внутренний - en1 192.168.2.1</p>

<p>сведения об интерфейсах брались тупо из</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ifconfig <span class="nt">-a</span>
</code></pre></div></div>

<p>Для начала врубаем фаервол.</p>

<p>В /etc/hostconfig из-под sudo -s прописать строчку</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>IPFORWARDING=-YES-
</code></pre></div></div>

<p>Далее пишем (первая строка для смелых и ленивых, не желающих настраивать фаервол)</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root# ipfw add 1200 pass all from any to any 
root# sysctl <span class="nt">-w</span> net.inet.ip.forwarding<span class="o">=</span>1
root# ipfw add 1280 divert 8868 all from 192.168.2.1 to any out via en1 
root# ipfw add 1290 divert 8868 all from any to 195.16.153.30 out via ppp0 
root# natd <span class="nt">-s</span> <span class="nt">-m</span> <span class="nt">-u</span> <span class="nt">-dynamic</span> <span class="nt">-clamp_mss</span> <span class="nt">-a</span> 195.16.153.30 <span class="nt">-p</span> 8868 
</code></pre></div></div>

<p>ключ -dynamic можно убрать, если тебе при установке соединения назначается статический IP адрес; ключ -u убираешь, если для машин в локальной сети ты назначил адреса не из стандартных диапазонов 192.168.0.0/16, 10.0.0.0/8</p>
:ET